<%- include("../partials/header.ejs"); -%> <%-
include("../partials/anavbar.ejs"); -%> <%- include('../partials/messages.ejs')
%>

<main class="container">
    <div class="my-3 p-3 bg-body rounded shadow-sm">
        <!--* Table -->
        <div class="table-responsive mt-1 p-5">
            <table
                class="
                    table
                    table-success
                    table-sm
                    table-striped
                    table-hover
                    table-bordered
                    border-secondary
                    caption-top
                    text-center
                "
            >
                <caption>
                    List of Messages
                </caption>
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Date Received</th>
                        <th scope="col">Read</th>
                        <th scope="col">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let message of messages) { %>
                    <tr>
                        <td><%= message.name %></td>
                        <td><%= message.email %></td>
                        <td><%= message.date %></td>
                        <!--* View Button  -->
                        <td>
                            <button
                                type="button"
                                class="btn btn-light"
                                data-bs-toggle="modal"
                                data-bs-target="#message-<%= message._id %>"
                            >
                                <i class="fas fa-book-reader"></i>
                            </button>
                        </td>
                        <!--* Delete Button  -->
                        <td>
                            <form
                                class="d-inline"
                                action="/messages/admin/list/:page?_method=DELETE"
                                method="POST"
                            >
                                <button
                                    class="btn btn-warning"
                                    name="deleteButton"
                                    value="<%= message._id %>"
                                    onclick="this.form.submit()"
                                >
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
            <!--* Pagination  -->
            <div class="mt-3">
                <% if (pages > 0) { %>
                <ul class="pagination text-center">
                    <% if (current == 1) { %>
                    <li class="disabled">
                        <a class="page-link text-secondary">First</a>
                    </li>
                    <% } else { %>
                    <li>
                        <a
                            class="page-link text-secondary"
                            href="/messages/admin/list/1"
                            >First</a
                        >
                    </li>
                    <% } %> <% var i = (Number(current) > 5 ? Number(current) -
                    4 : 1) %> <% if (i !== 1) { %>
                    <li class="disabled">
                        <a class="page-link text-secondary">...</a>
                    </li>
                    <% } %> <% for (; i <= (Number(current) + 4) && i <= pages;
                    i++) { %> <% if (i == current) { %>
                    <li class="active">
                        <a class="page-link text-secondary"><%= i %></a>
                    </li>
                    <% } else { %>
                    <li>
                        <a
                            class="page-link text-secondary"
                            href="/messages/admin/list/<%= i %>"
                            ><%= i %></a
                        >
                    </li>
                    <% } %> <% if (i == Number(current) + 4 && i < pages) { %>
                    <li class="disabled">
                        <a class="page-link text-secondary">...</a>
                    </li>
                    <% } %> <% } %> <% if (current == pages) { %>
                    <li class="disabled">
                        <a class="page-link text-secondary">Last</a>
                    </li>
                    <% } else { %>
                    <li>
                        <a
                            class="page-link text-secondary"
                            href="/messages/admin/list/<%= pages %>"
                            >Last</a
                        >
                    </li>
                    <% } %>
                </ul>
                <% } %>
            </div>
            <!--* /Pagination  -->
        </div>
    </div>

    <!--* Modal -->
    <% for(let message of messages) { %>
    <div
        class="modal fade"
        id="message-<%= message._id %>"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
    >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        Message Preview
                    </h5>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                    ></button>
                </div>
                <div class="modal-body">
                    <div class="col-md-9 mb-md-0 mb-5">
                        <!--Grid row-->
                        <div class="row">
                            <!--Grid column-->
                            <div class="col-md-6">
                                <div class="md-form mb-0">
                                    <input
                                        type="text"
                                        id="name"
                                        name="name"
                                        class="form-control"
                                        value="<%= message.name %>"
                                        readonly
                                    />
                                </div>
                            </div>
                            <!--*Grid column-->

                            <!--*Grid column-->
                            <div class="col-md-6">
                                <div class="md-form mb-0">
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        class="form-control"
                                        placeholder="Email Address"
                                        value="<%= message.email %>"
                                        readonly
                                    />
                                </div>
                                <br />
                            </div>
                            <!--*Grid column-->
                        </div>
                        <!--*Grid row-->

                        <!--*Grid row-->
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-form mb-0">
                                    <input
                                        type="text"
                                        id="title"
                                        name="title"
                                        class="form-control"
                                        value="<%= message.title %>"
                                        readonly
                                    />
                                </div>
                            </div>
                            <br />
                        </div>
                        <!-*-Grid row-->

                        <!--*Grid row-->
                        <div class="row mt-1">
                            <!--*Grid column-->
                            <div class="col-md-12">
                                <div class="md-form">
                                    <textarea
                                        type="text"
                                        id="body"
                                        name="body"
                                        rows="4"
                                        class="form-control md-textarea"
                                        readonly
                                    >
<%= message.body %></textarea
                                    >
                                </div>
                            </div>
                        </div>
                        <!--*Grid row-->
                    </div>
                    <!--* Reply Form -->
                    <div class="col-md-9 mb-md-0 mb-5 mt-5">
                        <form
                            id="mail-form"
                            name="mail-form"
                            action="/messages/admin/list/:page"
                            method="POST"
                            autocomplete="off"
                        >
                            <input
                                type="hidden"
                                id="to"
                                name="to"
                                value="<%= message.email %>"
                            />
                            <div>
                                <input
                                    class="form-control"
                                    type="text"
                                    id="title"
                                    value=""
                                    name="title"
                                    placeholder="Subject"
                                    required
                                />
                            </div>
                            <div>
                                <textarea
                                    class="form-control mt-1"
                                    id="body"
                                    name="body"
                                    value=""
                                    rows="4"
                                    placeholder="Message Here..."
                                    required
                                ></textarea>
                            </div>
                            <div>
                                <br />
                                <button class="btn btn-dark" type="submit">
                                    Send Email
                                    <i class="far fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="modal-footer">
                    <button
                        type="button"
                        class="btn btn-danger"
                        data-bs-dismiss="modal"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<% } %> <%-include("../partials/footer.ejs"); -%>
